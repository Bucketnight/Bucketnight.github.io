<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bucketnight / bucketkernel</title>
  <style>
    :root {
      --bg:#0d1117;--panel:#161b22;--border:#30363d;
      --text:#c9d1d9;--muted:#8b949e;--accent:#58a6ff;--green:#3fb950;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:ui-monospace,monospace;background:var(--bg);color:var(--text)}
    header{background:var(--panel);border-bottom:1px solid var(--border);padding:12px 20px}
    main{max-width:1200px;margin:20px auto;padding:0 16px}
    .repo-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    .repo-title span{color:var(--accent)}
    .btn{background:#21262d;border:1px solid var(--border);color:var(--text);padding:4px 8px;border-radius:6px;cursor:pointer}
    .panel{background:var(--panel);border:1px solid var(--border);border-radius:6px;overflow:hidden;animation:fadeIn .25s ease-out}
    .panel-header{padding:8px 12px;border-bottom:1px solid var(--border);font-size:13px;color:var(--muted)}
    table{width:100%;border-collapse:collapse}
    tr{border-bottom:1px solid var(--border);transition:background .15s ease}
    tr:hover{background:#0b0f14}
    td{padding:8px 12px;font-size:14px;vertical-align:top}
    td.name{color:var(--accent);cursor:pointer}
    td.name:hover{text-decoration:underline}
    pre{margin:0;padding:12px;overflow:auto;background:#0b0f14;font-size:13px}
    #viewer{margin-top:16px;display:none;animation:slideUp .25s ease-out}

    /* animations */
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
    @keyframes slideUp{from{transform:translateY(8px);opacity:0}to{transform:translateY(0);opacity:1}}
    @keyframes spin{to{transform:rotate(360deg)}}

    .spinner{width:16px;height:16px;border:2px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin .8s linear infinite;display:inline-block}
  </style>
</head>
<body>
<header>git</header>
<main>
  <div class="repo-header">
    <div class="repo-title"><span>Bucketnight</span> / bucketkernel</div>
    <a class="btn" href="https://github.com/torvalds/linux" target="_blank">GitHub</a>
  </div>

  <div class="panel">
    <div class="panel-header" id="path">
      <span id="crumbs">/</span>
      <span id="loading" style="float:right;display:none" class="spinner"></span>
    </div>
    <table id="filelist"></table>
  </div>

  <div class="panel" id="viewer">
    <div class="panel-header" id="viewer-title"></div>
    <pre id="viewer-content"></pre>
  </div>
</main>

<script>
const OWNER = "torvalds";
const REPO  = "linux";
let currentPath = "";

function $(id){ return document.getElementById(id); }

async function api(path){
  const res = await fetch(`https://api.github.com/repos/${OWNER}/${REPO}/${path}`);
  return res.json();
}

async function loadDir(path = ""){
  currentPath = path;
  $("path").firstChild.textContent = "/" + path;
  $("viewer").style.display = "none";
  $("loading").style.display = "inline-block";

  const items = await api(`contents/${path}`);
  const table = $("filelist");
  table.innerHTML = "";

  if(path){
    const up = document.createElement("tr");
    up.innerHTML = `<td class=name onclick=loadDir('${path.split('/').slice(0,-1).join('/')}')>üìÅ ..</td><td></td><td></td>`;
    table.appendChild(up);
  }

  $("loading").style.display = "none";

  items.forEach(i => {
    const tr = document.createElement("tr");
    if(i.type === "dir"){
      tr.innerHTML = `<td class=name onclick=loadDir('${i.path}')>üìÅ ${i.name}</td><td>dir</td><td><button class=btn onclick=downloadFolder()>zip</button></td>`;
    } else {
      tr.innerHTML = `<td class=name onclick=viewFile('${i.path}','${i.name}')>üìÑ ${i.name}</td><td>file</td><td><button class=btn onclick=downloadFile('${i.download_url}','${i.name}')>dl</button> <button class=btn onclick=history('${i.path}')>log</button></td>`;
    }
    table.appendChild(tr);
  });
}

async function viewFile(path, name){
  const data = await api(`contents/${path}`);
  const text = atob(data.content.replace(/\n/g, ''));
  const viewer = $("viewer");
  viewer.style.display = "block";
  viewer.style.animation = 'none';
  viewer.offsetHeight;
  viewer.style.animation = 'slideUp .25s ease-out';
  $("viewer-title").textContent = name;
  $("viewer-content").textContent = text;
}

function downloadFile(url, name){
  const a = document.createElement('a');
  a.href = url;
  a.download = name;
  a.click();
}

function downloadFolder(){
  window.open(`https://github.com/${OWNER}/${REPO}/archive/refs/heads/main.zip`, '_blank');
}

async function history(path){
  const commits = await api(`commits?path=${path}`);
  let out = "";
  commits.slice(0, 10).forEach(c => {
    out += `${c.commit.message}\n${c.commit.author.date}\n\n`;
  });
  const viewer = $("viewer");
  viewer.style.display = "block";
  $("viewer-title").textContent = "git log " + path;
  $("viewer-content").textContent = out;
}

// ensure DOM is ready before accessing elements
document.addEventListener("DOMContentLoaded", () => {
  loadDir();
});
</script>
</body>
</html>
